{{/*
  Project Maintainers Partial
  Displays maintainers associated with the current project
  Usage: {{ partial "project-maintainers.html" . }}
*/}}

{{ $projectTitle := .Title }}
{{ $projectMaintainers := slice }}

{{/* Method 1: Use maintainers field from project if available */}}
{{ if .Params.maintainers }}
  {{ range $maintainerName := .Params.maintainers }}
    {{ $maintainerPage := $.Site.GetPage (printf "/maintainers/%s" (urlize $maintainerName)) }}
    {{ if not $maintainerPage }}
      {{/* Try to find by title match */}}
      {{ range where $.Site.RegularPages "Section" "maintainers" }}
        {{ if eq .Title $maintainerName }}
          {{ $maintainerPage = . }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ if $maintainerPage }}
      {{ $projectMaintainers = $projectMaintainers | append $maintainerPage }}
    {{ end }}
  {{ end }}
{{ else }}
  {{/* Method 2: Fallback to reverse lookup from maintainer projects */}}
  {{ $allMaintainers := where .Site.RegularPages "Section" "maintainers" }}
  {{ range $maintainer := $allMaintainers }}
    {{ if $maintainer.Params.projects }}
      {{ range $projectName := $maintainer.Params.projects }}
        {{ if eq $projectName $projectTitle }}
          {{ $projectMaintainers = $projectMaintainers | append $maintainer }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if gt (len $projectMaintainers) 0 }}
<div class="project-maintainers-section">
  <h3 class="project-maintainers-title">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
      <circle cx="9" cy="7" r="4"></circle>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
    </svg>
    Maintainers
  </h3>
  <div class="project-maintainers-list">
    {{ range $projectMaintainers }}
    <a href="{{ .RelPermalink }}" class="project-maintainer-card">
      <div class="project-maintainer-avatar">
        {{ partial "maintainer-avatar.html" (dict "maintainer" . "size" 44) }}
      </div>
      <div class="project-maintainer-info">
        <div class="project-maintainer-name">{{ .Title }}</div>
        {{ if .Params.role }}
        <div class="project-maintainer-role">{{ .Params.role }}</div>
        {{ end }}
      </div>
    </a>
    {{ end }}
  </div>
</div>
{{ end }}
