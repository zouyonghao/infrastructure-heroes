{{ define "main" }}
<article class="project-detail">
    <div class="container-narrow">
        <header class="project-detail-header">
            {{ if .Params.logo }}
            <div class="project-detail-logo">
                <img src="{{ .Params.logo }}" alt="{{ .Title }} logo" loading="eager" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="logo-fallback" style="display: none;">
                    <span class="fallback-initial">{{ substr .Title 0 1 }}</span>
                </div>
            </div>
            {{ end }}
            <h1>{{ .Title }}</h1>
            {{ if .Params.description }}
            <p class="section-subtitle">{{ .Params.description }}</p>
            {{ end }}
        </header>

        {{ if .Params.health }}
        <div class="health-dashboard">
            <div class="health-score-display-large">
                <div class="health-score-number {{ if ge .Params.health.score 80 }}healthy{{ else if ge .Params.health.score 60 }}warning{{ else }}critical{{ end }}">
                    {{ .Params.health.score }}
                </div>
                <div class="health-score-status {{ if ge .Params.health.score 80 }}healthy{{ else if ge .Params.health.score 60 }}warning{{ else }}critical{{ end }}">
                    {{ if ge .Params.health.score 80 }}Project is healthy{{ else if ge .Params.health.score 60 }}Needs attention{{ else }}Critical - needs support{{ end }}
                </div>
            </div>

            <div class="health-dimensions">
                <div class="health-dimension {{ if eq .Params.health.funding "stable" }}good{{ else if eq .Params.health.funding "at-risk" }}warning{{ else }}critical{{ end }}">
                    <div class="dimension-icon-svg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="16"></line>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                    </div>
                    <div class="dimension-name">Funding</div>
                    <div class="dimension-value {{ if eq .Params.health.funding "stable" }}healthy{{ else if eq .Params.health.funding "at-risk" }}warning{{ else }}critical{{ end }}">
                        {{ .Params.health.funding | humanize }}
                    </div>
                </div>

                <div class="health-dimension {{ if eq .Params.health.maintenance "active" }}good{{ else if eq .Params.health.maintenance "moderate" }}warning{{ else }}critical{{ end }}">
                    <div class="dimension-icon-svg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                        </svg>
                    </div>
                    <div class="dimension-name">Maintenance</div>
                    <div class="dimension-value {{ if eq .Params.health.maintenance "active" }}healthy{{ else if eq .Params.health.maintenance "moderate" }}warning{{ else }}critical{{ end }}">
                        {{ .Params.health.maintenance | humanize }}
                    </div>
                </div>

                <div class="health-dimension {{ if eq .Params.health.contributors "healthy" }}good{{ else if eq .Params.health.contributors "declining" }}warning{{ else }}critical{{ end }}">
                    <div class="dimension-icon-svg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </div>
                    <div class="dimension-name">Contributors</div>
                    <div class="dimension-value {{ if eq .Params.health.contributors "healthy" }}healthy{{ else if eq .Params.health.contributors "declining" }}warning{{ else }}critical{{ end }}">
                        {{ .Params.health.contributors | humanize }}
                    </div>
                </div>

                <div class="health-dimension {{ if eq .Params.health.bus_factor "low" }}good{{ else if eq .Params.health.bus_factor "medium" }}warning{{ else }}critical{{ end }}">
                    <div class="dimension-icon-svg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <div class="dimension-name">Bus Factor</div>
                    <div class="dimension-value {{ if eq .Params.health.bus_factor "low" }}healthy{{ else if eq .Params.health.bus_factor "medium" }}warning{{ else }}critical{{ end }}">
                        {{ .Params.health.bus_factor | humanize }} risk
                    </div>
                </div>
            </div>

            {{ if lt .Params.health.score 60 }}
            <div class="alert-critical" style="margin-top: 24px;">
                <div class="alert-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                </div>
                <div class="alert-content">
                    <strong>This project needs your help!</strong>
                    Consider contributing code, documentation, or funding to help maintain this critical infrastructure.
                </div>
            </div>
            {{ end }}
            
            {{ if .Params.metrics.updated_at }}
            <div class="last-updated-section">
                <span class="metrics-timestamp">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    {{ $updatedDate := time .Params.metrics.updated_at }}
                    {{ $daysAgo := div (sub now.Unix $updatedDate.Unix) 86400 }}
                    Metrics last updated: 
                    {{ if eq $daysAgo 0 }}
                        today
                    {{ else if eq $daysAgo 1 }}
                        yesterday
                    {{ else if lt $daysAgo 30 }}
                        {{ $daysAgo }} days ago
                    {{ else if lt $daysAgo 60 }}
                        1 month ago
                    {{ else }}
                        {{ div $daysAgo 30 }} months ago
                    {{ end }}
                    ({{ .Params.metrics.updated_at }})
                </span>
            </div>
            {{ end }}
        </div>
        {{ end }}

        {{ partial "project-successor.html" . }}

        {{ partial "project-maintainers.html" . }}

        {{ partial "project-maintainer-successors.html" . }}

        {{ partial "project-succession-planning.html" . }}

        <div class="project-content">
            {{ .Content }}
        </div>

        {{ partial "dependency-map.html" . }}

        <div class="project-back-link">
            <a href="/projects/" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Back to all projects
            </a>
        </div>
    </div>
</article>
{{ end }}
